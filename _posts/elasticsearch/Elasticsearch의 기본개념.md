# 클러스터와 노드의 개념
## 클러스터란?
 여러 대의 컴퓨터와 혹은 구성 요소들을 논리적으로 결합하여 전체를 하나의 컴퓨터 혹은 하나의 구성 요소처럼 사용할 수 있게 해주는 기술입니다.
## Elasticsearch에서의 클러스터
Elasticsearch 클러스터 역시 **여러 개의 ElasticSearch 프로세들을 논리적으로 결합**하여 **하나의 ElasticSearch 프로세스처럼** 사용할 수 있게 해줍니다.
## Elasticsearch에서의 노드
클러스터를 구성하는 하나하나의 ElasticSearch 프로세스를 노드라고 부른다, 즉 ElasitcSearch의 클러스터란 이 **노드들을 하나의 ElasticSearch 프로세스처럼** 동작하게 하는 것이 클러스터입니다.

## 클러스터의 특징
클러스터는 보통 단일 노드로 구성하지 않습니다,
클러스터의 주 목적은 노드에 장애가 발생하였을때 ElasticSearch 에 접근할 수 없는 요청 불가 상태를 방지하기 위함이며,
여러 노드로 클러스터를 구성하였다면 하나의 노드에 장애가 발생해도 다른 노드에 요청할 수 있기에 안정적으로 서비스를 유지할 수 있습니다.
그렇기 때문에 다수의 노드로 구성하는 것이 바람직하며
이렇게 다수 노드로 구성된 클러스터는 고유의 **클러스터 이름**과, **UUID**를 가집니다.

이 고유한 두 속성을 통해 클러스터 내에 속한 노드들이 서로 동일한 클러스터 내에 있음을 인식하게 됩니다.
ElasticSearch에 아래와 같은 요청을 보내면 **클러스터의 이름**과 **UUID**를 확인할 수 있습니다.


```JSON
// curl localhost:9200 엘라스틱 서치 서비스가 가동중인 포트 번호로 요청을 보냅니다.
{
    "name" : "elasticsearch", 
    "cluster_name" : "my-elasticsearch",
    "cluster_uuid" : "68Dns~~~~",
    "version" : {
        //~~~
    }
}
```
- **name**
  클러스터에 속한 노드들 중 현재 요청에 응답한 노드의 이름입니다 클러스터가 다수의 노드로 구성되어 있다면 노드별로 값이 달라집니다

- **cluster_name**
  클러스터의 이름입니다. 클러스터에 속한 모든 노드들은 **클러스터 이름**이 같습니다.
  새로운 노드를 클러스터에 추가하기 위해서는 같은 **클러스터 이름**을 사용해야합니다.

- **cluster_uuid**
  클러스터의 UUID입니다. 클러스터에 속한 모든 노드들이 동일한 값을 같습니다.
  이 값은 **클러스터가 최초 생성될 때 자동으로 생성**됩니다.

## 노드의 특징
노드는 클러스터를 구성하는 논리적인 ElasticSearch 프로세스 하나를 의미합니다
노드도 클러스터와 마찬가지로 각각의 고유한 노드 이름과 uuid가 있고,
역할에 따라 여러 가지 노드로 구분할 수 있습니다
노드의 역할은 아래 표와 같습니다.
|**노드 역할**|**설명**|
|---|---|
|**마스터**|클러스터 구성에서 **중심**이 되는 노드. **클러스터의 상태** 등 **메타데이터**를 관리합니다.|
|**데이터**|사용자의 **문서를 실제로 저장**하는 노드|
|**인제스트**|사용자의 문서가 저장되기 전 **문서 내용을 사전 처리**하는 노드|
|**코디네이트**|사용자의 요청을 데이터 노드로 **전달**하고, 다시 데이터 노드로부터 **결과를 취합**하는 노드|

위 표와 같이 노드가 할 수 있는 역할은 총 4가지이며, 각각 하나의 역할만 할 수 있는게 아니라 한 번에 여러 개의 역할을 할 수 있습니다. 각각의 역할을 조금 더 자세히 살펴봅시다.
### 마스터 노드
클러스터의 메타데이터를 관리하는 역할을 하며 반드시 한 대 이상으로 구성해야합니다.
클러스터 내의 모든 노드는 현재 **노드의 상태**, **성능 정보**, 자신이 가지고 있는 **샤드의 정보**를 마스터 노드에 알립니다.
마스터 노드는 이런 정보들을 수집하고 관리하면서 클러스터의 안정성을 확보하기 위해 필요한 작업들을 진행합니다.

### 데이터 노드
사용자가 색인한 **문서를 저장**하고, **검색 요청을 처리해서 결과를 돌려주는 역할**을 합니다.
또한 자신이 받은 요청 중 자신이 처리할 수 있는 요청은 직접 처리하고, 다른 데이터 노드들이 처리해야 할 요청은 해당 데이터 노드에 전달합니다. 이때 어떤 데이터 노드로 요청을 전달할 것인지는 마스터 노드를 통해 받은 클러스터의 전체 상태 정보를 바탕으로 합니다.

### 인제스트 노드
사용자가 색인하길 원하는 문서의 내용 중 **변환이 필요한 부분을 사전에 처리**합니다. 데이터 노드에 저장하기 전에 특정 필드의 값을 가공해야할 경우 유용하게 동작합니다.

### 코디네이트 노드
실제 데이터를 저장하고 처리하지는 않지만, 사용자의 색인이나 검색 등 **모든 요청을 데이터 노드에 전달**하는 역할을 합니다..

클러스터를 운용하면서 꼭 유념할 부분이 있습니다.
클러스터 내에서 메타데이터를 관리하는 마스터 노드는 한 대라는 것 입니다.
헷갈릴 수 있는 부분이
- **마스터 노드 역할이 가능한 후보 노드**
- **마스터 노드 역할을 하는 노드**
위와 같이 두 개념이 있기 때문에 헷갈릴 수 있습니다.

만약 클러스터를 구성할 때 총 3개의 노드로 구성을 하고 3개의 노드를 모두 **마스터 역할이 가능한 후보 노드** 로 구성한다면, 마스터 노드 역할을 하고있는 노드에 장애가 발생하였을 때 나머지 2개의 **마스터 노드 역할이 가능한 후보 노드** 중 한대가 마스터 노드의 역할을 하게됩니다.

**마스터 후보 노드**들은 마스터 노드로부터 지속적으로 클러스터 운영에 필요한 데이터를 전달받기 때문에 항상 같은 메타 데이터를 유지하고 있습니다. 그래서 마스터 노드에 장애가 발생하여 마스터 노드가 변경되어도 중단 없이 서비스를 이어갈 수 있습니다. 


# 인덱스와 타입


# 샤드와 세그먼트
 